<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    
    
    <title>Search company location</title>

    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
      <form class="form-horizontal">
    <div class="form-group form-group-lg">
      <h2>Type company name to search: </h2>
      <label class="col-sm-2 control-label" for="lg"></label>
        <input class="form-control" type="text" id="lg"> </div>
    <button class="btn btn-outline-success my-2 my-sm-0" type="submit" id="SearchButton">Search</button >
    </form>
    <h2> Results found </h2>
    <p id="results"></p>
<div id="accordionResults" style="display:none">
  <div class="card">
    <div class="card-header" id="headingOne">
      <h5 class="mb-0">
        <button class="btn btn-link" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          Collapsible Group Item #1
        </button>
      </h5>
    </div>

    <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordion">
      <div class="card-body">
        Working hours.
      </div>
    </div>
  </div>
  <div class="card">
    <div class="card-header" id="headingTwo">
      <h5 class="mb-0">
        
</div>

    <script>
      //var map;
      //function initMap() {
        //map = new google.maps.Map(document.getElementById('map'), {
         // center: {lat: -34.397, lng: 150.644},
         // zoom: 8
        //});
      //}

      //function httpGetAsync(callback) {
        document.getElementById("SearchButton").addEventListener("click",
          function() {
            //var request = new XMLHttpRequest();
            var textSearchValue = document.getElementById("lg").value;
        //console.log(textSearchValue);
        urlPartConstant = "https://cryptic-headland-94862.herokuapp.com/https://maps.googleapis.com/maps/api/place/nearbysearch/json?key=AIzaSyC-gbAud482KRJPWgVy2BYr_NoUr0qSGsE&location=45.5576996,-74.0104801&radius=50000&name=";
        theUrl = urlPartConstant + textSearchValue;
        urlPartConstantDetail = "https://cryptic-headland-94862.herokuapp.com/https://maps.googleapis.com/maps/api/place/details/json?key=AIzaSyC-gbAud482KRJPWgVy2BYr_NoUr0qSGsE&placeid=";
        

        fetch(theUrl).then(
          function(response){
            return response.json();
          }
        ).then(function(jsonData){
          jsonData.results.slice(-5).forEach(place => {
              var tempPlaceID = place.place_id;
              urlDetail = urlPartConstantDetail + tempPlaceID;
              fetch(urlDetail).then(
                function(response){
                  return response.json();
                }).then(function(jsondataDetail){
                  //console.log(jsondataDetail);
                  //console.log(jsondataDetail.result.opening_hours.weekday_text);
                  document.getElementById("accordionResults").style.display = "inline";
                  var newDiv = "<div><h3>Q2 New Question</h3><div>New Content</div></div>";
                  $('.headingOne').append(newDiv);
                  //$('.accordion').accordion("refresh");   
                  //document.getElementById("headingOne").innerHTML += "<b>" + place.name + "</b>" + "<br/>";
                  jsondataDetail.result.opening_hours.weekday_text.forEach(workingDays => {
                    document.getElementById("collapseOne").innerHTML += workingDays + "<br/>";
                  })
                })
              console.log(place);
              console.log(place.name);
              
            })
    //handle json data processing here
        });

        })

          // Begin accessing JSON data here
        //   var data = JSON.parse(this.response);
        //   console.log(data);

        //   if (request.status >= 200 && request.status < 400) {
        //     data.results.forEach(place => {
        //       UrlDetail = urlPartConstantDetail + place.id;
        //       request.open('GET', UrlDetail, true);
        //       var data2 = JSON.parse(this.response);
        //       console.log(data2);

        //   // Begin accessing JSON data here
        //   var data = JSON.parse(this.response);
        //       console.log(place.name);
        //       console.log(place.opening_hours);
        //       //var newElement = document.createElement("div");
        //       // Set the value to what you want
        //       //newElement.innerHTML = box.value;
        //       //document.body.appendChild(newElement);
        //       //document.writeln(place.name, ", Opening hours: ");
        //       document.getElementById('results').innerHTML += place.name + ", " +
        //       "<b>" + "Working hours: " + "<br/>" ;
              
        //     });
        //   } else {
        //     console.log('error');
        //   }
        // }
        // request.send()
        //   },
        //   false
        // );



        // var textSearchValue = document.getElementById("lg").value;
        // //console.log(textSearchValue);
        // urlPartConstant = "https://cryptic-headland-94862.herokuapp.com/https://maps.googleapis.com/maps/api/place/nearbysearch/json?key=AIzaSyC-gbAud482KRJPWgVy2BYr_NoUr0qSGsE&location=45.5576996,-74.0104801&radius=50000&name=";
        // theUrl = urlPartConstant + textSearchValue;
        

        // request.open('GET', theUrl, true);
        // request.onload = function () {

        //   // Begin accessing JSON data here
        //   var data = JSON.parse(this.response);

        //   if (request.status >= 200 && request.status < 400) {
        //     data.forEach(movie => {
        //       console.log(movie.title);
        //     });
        //   } else {
        //     console.log('error');
        //   }
        // }

        // request.send();




        // fetch(theUrl).then(function(response) {
        //   return response.json();
        //   }).then(function(data) {
        //     //console.log(data);
        //     JSON.parse(data);
        //     //if (request.status >= 200 && request.status < 400) {
        //       data.forEach(place => {
        //       console.log(place.name);
        //       });
        //     });
        //   }

              //}.catch(function() {
              //console.log("Booo");
              //});


        

        // var xmlHttp = new XMLHttpRequest();
        // xmlHttp.onreadystatechange = function() { 
        // if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
        //     callback(xmlHttp.responseText);
        // }
        // xmlHttp.open("GET", theUrl, true); // true for asynchronous 
        // xmlHttp.send(null);
        // }
    </script>
    
  </body>
</html>

